---
/**
 * Localized blog post page.
 * Routes: /nl/blog/[slug]/, /de/blog/[slug]/, etc.
 */
import { getCollection } from 'astro:content';
import BlogPostPage from '../../../components/pages/BlogPostPage.astro';
import { supportedLanguages, pageSlugTranslations } from '../../../i18n/translations';
import type { SupportedLanguage } from '../../../i18n/translations';

export const prerender = true;

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const paths: { params: { lang: string; blogSlug: string; postSlug: string }; props: { post: typeof posts[0] } }[] = [];
  
  for (const lang of supportedLanguages.filter(l => l !== 'en') as SupportedLanguage[]) {
    // Get localized 'blog' slug
    const blogSlug = pageSlugTranslations[lang]?.['blog'] || 'blog';
    
    for (const post of posts) {
      paths.push({
        params: { lang, blogSlug, postSlug: post.slug },
        props: { post }
      });
    }
  }
  
  return paths;
}

interface Props {
  post: Awaited<ReturnType<typeof getCollection<'blog'>>>[0];
}

const { lang } = Astro.params;
const { post } = Astro.props;
---

<BlogPostPage post={post} lang={lang as SupportedLanguage} />
