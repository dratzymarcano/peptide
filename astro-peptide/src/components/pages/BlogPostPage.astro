---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { t, getLocalizedPath } from '../../i18n/translations';
import type { SupportedLanguage } from '../../i18n/translations';

interface Props {
  post: CollectionEntry<'blog'>;
  lang?: SupportedLanguage;
}

const { post, lang = 'en' } = Astro.props;
const currentLang = lang;
const { Content, headings } = await post.render();

// Helper function to strip language prefix from blog slugs
function stripLangPrefix(slug: string): string {
  return slug
    .replace(/^(en|nl|de|fr|es|it|ru)\//, '')
    .replace(/^(nl|de|fr|es|it|ru)-/, '');
}

// Get related posts (same category AND same language, excluding current)
const allPosts = await getCollection('blog');
const baseSlug = stripLangPrefix(post.slug);
const availableLangs = Array.from(new Set(
  allPosts
    .filter(p => stripLangPrefix(p.slug) === baseSlug)
    .map(p => (p.data.lang || 'en') as SupportedLanguage)
));
const relatedPosts = allPosts
  .filter(p => p.data.category === post.data.category && p.slug !== post.slug && p.data.lang === currentLang)
  .sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime())
  .slice(0, 3);

// Get more posts from same language for "You might also like"
const morePosts = allPosts
  .filter(p => p.slug !== post.slug && p.data.lang === currentLang && p.data.category !== post.data.category)
  .sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime())
  .slice(0, 2);

// Get products for internal linking (silo structure)
const products = await getCollection('products');
const relatedProducts = products
  .filter(p => {
    const postTags = post.data.tags?.map(t => t.toLowerCase()) || [];
    const productTitle = p.data.title.toLowerCase();
    return postTags.some(tag => productTitle.includes(tag.split(' ')[0]));
  })
  .slice(0, 3);

// Fallback to featured products if no tag match
const sidebarProducts = relatedProducts.length > 0 
  ? relatedProducts 
  : products.filter(p => Boolean((p.data as any).featured)).slice(0, 3);

// Calculate reading time
function getReadingTime(content: string): number {
  const wordsPerMinute = 200;
  const words = content.split(/\s+/).length;
  return Math.ceil(words / wordsPerMinute);
}

// Format date
function formatDate(date: string): string {
  return new Date(date).toLocaleDateString(
    currentLang === 'en' ? 'en-GB' : currentLang, 
    { day: 'numeric', month: 'long', year: 'numeric' }
  );
}

function formatShortDate(date: string): string {
  return new Date(date).toLocaleDateString(
    currentLang === 'en' ? 'en-GB' : currentLang, 
    { day: 'numeric', month: 'short', year: 'numeric' }
  );
}

// Get post URL
function getPostUrl(p: any): string {
  const slug = stripLangPrefix(p.slug);
  return currentLang === 'en' 
    ? `/blog/${slug}/` 
    : getLocalizedPath(`/blog/${slug}/`, currentLang);
}

function getCategoryUrl(category: string): string {
  const slug = category.toLowerCase().replace(/\s+/g, '-');
  return getLocalizedPath(`/blog/category/${slug}/`, currentLang);
}

// UI Text
const uiText = {
  readMore: t(currentLang, 'common.readMore') || 'Read More',
  share: t(currentLang, 'common.share') || 'Share',
  tableOfContents: t(currentLang, 'blogPage.tableOfContents') || 'Table of Contents',
  relatedArticles: t(currentLang, 'blogPage.relatedArticles') || 'Related Articles',
  moreArticles: t(currentLang, 'blogPage.moreArticles') || 'You Might Also Like',
  backToBlog: t(currentLang, 'common.backTo') + ' ' + t(currentLang, 'nav.blog') || 'Back to Blog',
  minRead: t(currentLang, 'blogPage.minRead') || 'min read',
  writtenBy: t(currentLang, 'blogPage.writtenBy') || 'Written by',
  shopPeptides: t(currentLang, 'blogPage.shopPeptides') || 'Shop Peptides',
  exploreProducts: t(currentLang, 'blogPage.exploreProducts') || 'Explore our research peptides',
  viewAll: t(currentLang, 'common.viewAll') || 'View All',
};

// Article Schema
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": post.data.title,
  "image": post.data.image ? new URL(post.data.image, Astro.site).href : undefined,
  "datePublished": new Date(post.data.publishDate).toISOString(),
  "dateModified": new Date(post.data.publishDate).toISOString(),
  "author": {
    "@type": "Person",
    "name": post.data.author
  },
  "publisher": {
    "@type": "Organization",
    "name": "Peptide Shop",
    "logo": {
      "@type": "ImageObject",
      "url": "https://peptide-shop.net/images/logo.png"
    }
  },
  "description": post.data.meta.description,
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": Astro.url.href
  }
};

// Breadcrumb Schema
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": t(currentLang, 'common.home'),
      "item": new URL(getLocalizedPath('/', currentLang), Astro.site).href
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": t(currentLang, 'nav.blog'),
      "item": new URL(getLocalizedPath('/blog/', currentLang), Astro.site).href
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": post.data.title,
      "item": Astro.url.href
    }
  ]
};

const postSlug = baseSlug;
const canonicalUrl = currentLang === 'en' 
  ? `https://peptide-shop.net/blog/${postSlug}/`
  : `https://peptide-shop.net/${currentLang}/blog/${postSlug}/`;
---

<Layout 
  title={post.data.meta.title} 
  description={post.data.meta.description}
  image={post.data.image}
  lang={currentLang}
  article={true}
  availableLangs={availableLangs}
  breadcrumbs={[
    { name: t(currentLang, 'common.home'), url: getLocalizedPath('/', currentLang) },
    { name: t(currentLang, 'nav.blog'), url: getLocalizedPath('/blog/', currentLang) },
    { name: post.data.title, url: getPostUrl(post) }
  ]}
>
  <script is:inline type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
  <script is:inline type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <div class="blog-post-page">
    <!-- Hero Section -->
    <section class="post-hero">
      <div class="container">
        <div class="hero-content">
          <!-- Breadcrumb -->
          <nav class="breadcrumb" aria-label="Breadcrumb">
            <a href={getLocalizedPath('/', currentLang)}>{t(currentLang, 'common.home')}</a>
            <span class="separator">/</span>
            <a href={getLocalizedPath('/blog/', currentLang)}>{t(currentLang, 'nav.blog')}</a>
            <span class="separator">/</span>
            <a href={getCategoryUrl(post.data.category)}>{post.data.category}</a>
          </nav>

          <!-- Category & Reading Time -->
          <div class="post-meta-top">
            <a href={getCategoryUrl(post.data.category)} class="category-badge">
              {post.data.category}
            </a>
            <span class="reading-time">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              5 {uiText.minRead}
            </span>
          </div>

          <!-- Title -->
          <h1 class="post-title">{post.data.title}</h1>

          <!-- Author & Date -->
          <div class="author-row">
            <div class="author-info">
              <div class="author-avatar">
                {post.data.author.charAt(0)}
              </div>
              <div class="author-details">
                <span class="author-label">{uiText.writtenBy}</span>
                <span class="author-name">{post.data.author}</span>
              </div>
            </div>
            <div class="post-date">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              {formatDate(post.data.publishDate)}
            </div>
          </div>
        </div>
      </div>
      <div class="hero-decoration">
        <div class="deco-circle circle-1"></div>
        <div class="deco-circle circle-2"></div>
      </div>
    </section>

    <!-- Featured Image -->
    {post.data.image && (
      <section class="featured-image-section">
        <div class="container">
          <div class="featured-image-wrapper">
            <img src={post.data.image} alt={post.data.title} class="featured-image" loading="eager" />
          </div>
        </div>
      </section>
    )}

    <!-- Main Content -->
    <section class="content-section">
      <div class="container">
        <div class="content-grid">
          <!-- Sidebar (Desktop) -->
          <aside class="sidebar">
            <!-- Table of Contents -->
            {headings.length > 0 && (
              <div class="sidebar-card toc-card">
                <h3 class="sidebar-title">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="8" y1="6" x2="21" y2="6"></line>
                    <line x1="8" y1="12" x2="21" y2="12"></line>
                    <line x1="8" y1="18" x2="21" y2="18"></line>
                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                  </svg>
                  {uiText.tableOfContents}
                </h3>
                <nav class="toc-nav">
                  {headings.filter(h => h.depth <= 3).map(heading => (
                    <a 
                      href={`#${heading.slug}`} 
                      class={`toc-link depth-${heading.depth}`}
                      data-heading={heading.slug}
                    >
                      {heading.text}
                    </a>
                  ))}
                </nav>
              </div>
            )}

            <!-- Share -->
            <div class="sidebar-card share-card">
              <h3 class="sidebar-title">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="18" cy="5" r="3"></circle>
                  <circle cx="6" cy="12" r="3"></circle>
                  <circle cx="18" cy="19" r="3"></circle>
                  <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                  <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                </svg>
                {uiText.share}
              </h3>
              <div class="share-buttons">
                <a 
                  href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(post.data.title)}&url=${encodeURIComponent(canonicalUrl)}`} 
                  target="_blank" 
                  rel="noopener noreferrer" 
                  class="share-btn twitter"
                  aria-label="Share on Twitter"
                >
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
                  </svg>
                </a>
                <a 
                  href={`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(canonicalUrl)}&title=${encodeURIComponent(post.data.title)}`} 
                  target="_blank" 
                  rel="noopener noreferrer" 
                  class="share-btn linkedin"
                  aria-label="Share on LinkedIn"
                >
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path>
                  </svg>
                </a>
                <a 
                  href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(canonicalUrl)}`} 
                  target="_blank" 
                  rel="noopener noreferrer" 
                  class="share-btn facebook"
                  aria-label="Share on Facebook"
                >
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path>
                  </svg>
                </a>
                <button 
                  class="share-btn copy"
                  aria-label="Copy link"
                  data-url={canonicalUrl}
                >
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Products Silo -->
            {sidebarProducts.length > 0 && (
              <div class="sidebar-card products-card">
                <h3 class="sidebar-title">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <path d="M16 10a4 4 0 0 1-8 0"></path>
                  </svg>
                  {uiText.shopPeptides}
                </h3>
                <div class="product-links">
                  {sidebarProducts.map(product => (
                    <a href={getLocalizedPath(`/peptides/${product.slug}/`, currentLang)} class="product-link">
                      <span>{product.data.title.split('|')[0].trim()}</span>
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                      </svg>
                    </a>
                  ))}
                </div>
                <a href={getLocalizedPath('/peptides/', currentLang)} class="view-all-btn">
                  {uiText.viewAll}
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                    <polyline points="12 5 19 12 12 19"></polyline>
                  </svg>
                </a>
              </div>
            )}
          </aside>

          <!-- Article Content -->
          <article class="article-content">
            <div class="prose">
              <Content />
            </div>

            <!-- Tags -->
            {post.data.tags && post.data.tags.length > 0 && (
              <div class="post-tags">
                <span class="tags-label">Tags:</span>
                <div class="tags-list">
                  {post.data.tags.map(tag => (
                    <span class="tag">{tag}</span>
                  ))}
                </div>
              </div>
            )}

            <!-- Author Box -->
            <div class="author-box">
              <div class="author-avatar-large">
                {post.data.author.charAt(0)}
              </div>
              <div class="author-box-content">
                <span class="author-box-label">{uiText.writtenBy}</span>
                <h4 class="author-box-name">{post.data.author}</h4>
                <p class="author-box-bio">
                  Expert in peptide research and laboratory protocols. Our team provides accurate, science-based information for researchers.
                </p>
              </div>
            </div>

            <!-- Mobile Share -->
            <div class="mobile-share">
              <h3>{uiText.share}</h3>
              <div class="share-buttons">
                <a 
                  href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(post.data.title)}&url=${encodeURIComponent(canonicalUrl)}`} 
                  target="_blank" 
                  rel="noopener noreferrer" 
                  class="share-btn twitter"
                >
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
                  </svg>
                </a>
                <a 
                  href={`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(canonicalUrl)}&title=${encodeURIComponent(post.data.title)}`} 
                  target="_blank" 
                  rel="noopener noreferrer" 
                  class="share-btn linkedin"
                >
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path>
                  </svg>
                </a>
                <a 
                  href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(canonicalUrl)}`} 
                  target="_blank" 
                  rel="noopener noreferrer" 
                  class="share-btn facebook"
                >
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path>
                  </svg>
                </a>
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>

    <!-- Related Articles -->
    {relatedPosts.length > 0 && (
      <section class="related-section">
        <div class="container">
          <div class="section-header">
            <h2 class="section-title">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
              </svg>
              {uiText.relatedArticles}
            </h2>
          </div>
          <div class="related-grid">
            {relatedPosts.map(related => (
              <article class="related-card">
                <a href={getPostUrl(related)} class="related-image-link">
                  {related.data.image ? (
                    <img src={related.data.image} alt={related.data.title} loading="lazy" />
                  ) : (
                    <div class="placeholder">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                      </svg>
                    </div>
                  )}
                </a>
                <div class="related-content">
                  <a href={getCategoryUrl(related.data.category)} class="related-category">
                    {related.data.category}
                  </a>
                  <h3 class="related-title">
                    <a href={getPostUrl(related)}>{related.data.title}</a>
                  </h3>
                  <div class="related-meta">
                    <span>{formatShortDate(related.data.publishDate)}</span>
                  </div>
                </div>
              </article>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- More Articles -->
    {morePosts.length > 0 && (
      <section class="more-section">
        <div class="container">
          <div class="section-header">
            <h2 class="section-title">{uiText.moreArticles}</h2>
          </div>
          <div class="more-grid">
            {morePosts.map(more => (
              <article class="more-card">
                <div class="more-number">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                  </svg>
                </div>
                <div class="more-content">
                  <a href={getCategoryUrl(more.data.category)} class="more-category">
                    {more.data.category}
                  </a>
                  <h3 class="more-title">
                    <a href={getPostUrl(more)}>{more.data.title}</a>
                  </h3>
                  <p class="more-excerpt">{more.data.description}</p>
                  <a href={getPostUrl(more)} class="more-link">
                    {uiText.readMore}
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                  </a>
                </div>
              </article>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Back to Blog CTA -->
    <section class="back-section">
      <div class="container">
        <a href={getLocalizedPath('/blog/', currentLang)} class="back-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
          {uiText.backToBlog}
        </a>
      </div>
    </section>
  </div>
</Layout>

<script>
  // Copy link functionality
  document.querySelectorAll('.share-btn.copy').forEach(btn => {
    btn.addEventListener('click', async () => {
      const url = btn.getAttribute('data-url');
      if (url) {
        await navigator.clipboard.writeText(url);
        btn.classList.add('copied');
        setTimeout(() => btn.classList.remove('copied'), 2000);
      }
    });
  });

  // Active TOC highlighting
  const tocLinks = document.querySelectorAll('.toc-link');
  const headings = document.querySelectorAll('h2[id], h3[id]');

  if (tocLinks.length > 0 && headings.length > 0) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          tocLinks.forEach(link => link.classList.remove('active'));
          const activeLink = document.querySelector(`.toc-link[data-heading="${entry.target.id}"]`);
          if (activeLink) activeLink.classList.add('active');
        }
      });
    }, { rootMargin: '-20% 0px -80% 0px' });

    headings.forEach(heading => observer.observe(heading));
  }
</script>

<style>
  .blog-post-page {
    background: #f8fafc;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  /* Hero Section */
  .post-hero {
    background: linear-gradient(135deg, #023e8a 0%, #0077b6 50%, #00b4d8 100%);
    padding: 4rem 0 3rem;
    position: relative;
    overflow: hidden;
  }

  .hero-content {
    position: relative;
    z-index: 2;
    max-width: 800px;
  }

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    font-size: 0.875rem;
  }

  .breadcrumb a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: color 0.2s;
  }

  .breadcrumb a:hover { color: white; }
  .breadcrumb .separator { color: rgba(255, 255, 255, 0.5); }

  .post-meta-top {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .category-badge {
    background: rgba(255, 255, 255, 0.15);
    color: white;
    padding: 0.375rem 1rem;
    border-radius: 50px;
    font-size: 0.8125rem;
    font-weight: 600;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    backdrop-filter: blur(10px);
    transition: background 0.3s;
  }

  .category-badge:hover { background: rgba(255, 255, 255, 0.25); color: white; }

  .reading-time {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.875rem;
  }

  .post-title {
    font-size: clamp(1.75rem, 4vw, 2.75rem);
    font-weight: 800;
    color: white;
    line-height: 1.25;
    margin: 0 0 1.5rem;
  }

  .author-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .author-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .author-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.125rem;
    border: 2px solid rgba(255, 255, 255, 0.3);
  }

  .author-details { display: flex; flex-direction: column; }
  .author-label { font-size: 0.75rem; color: rgba(255, 255, 255, 0.7); }
  .author-name { font-size: 1rem; font-weight: 600; color: white; }

  .post-date {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: rgba(255, 255, 255, 0.85);
    font-size: 0.9375rem;
  }

  .hero-decoration {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .deco-circle {
    position: absolute;
    border-radius: 50%;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .circle-1 { width: 500px; height: 500px; top: -200px; right: -150px; }
  .circle-2 { width: 300px; height: 300px; bottom: -100px; left: 10%; background: rgba(255, 255, 255, 0.03); }

  /* Featured Image */
  .featured-image-section {
    margin-top: -2rem;
    position: relative;
    z-index: 10;
    padding-bottom: 2rem;
  }

  .featured-image-wrapper {
    max-width: 900px;
    margin: 0 auto;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.2);
  }

  .featured-image {
    width: 100%;
    height: auto;
    max-height: 500px;
    object-fit: cover;
    display: block;
  }

  /* Content Section */
  .content-section {
    padding: 3rem 0;
  }

  .content-grid {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 3rem;
    align-items: start;
  }

  /* Sidebar */
  .sidebar {
    position: sticky;
    top: 100px;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .sidebar-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  }

  .sidebar-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    font-weight: 600;
    color: #1e293b;
    margin: 0 0 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #f1f5f9;
  }

  .sidebar-title svg { color: #0077b6; }

  /* TOC */
  .toc-nav {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .toc-link {
    color: #64748b;
    text-decoration: none;
    font-size: 0.875rem;
    padding: 0.375rem 0;
    border-left: 2px solid transparent;
    padding-left: 0.75rem;
    transition: all 0.2s;
    line-height: 1.4;
  }

  .toc-link:hover { color: #0077b6; }
  .toc-link.active { color: #0077b6; border-left-color: #0077b6; font-weight: 500; }
  .toc-link.depth-3 { padding-left: 1.5rem; font-size: 0.8125rem; }

  /* Share */
  .share-buttons {
    display: flex;
    gap: 0.5rem;
  }

  .share-btn {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    transition: all 0.3s;
    border: none;
    cursor: pointer;
  }

  .share-btn:hover { transform: scale(1.1); color: white; }
  .share-btn.twitter { background: #1da1f2; }
  .share-btn.linkedin { background: #0077b5; }
  .share-btn.facebook { background: #1877f2; }
  .share-btn.copy { background: #64748b; }
  .share-btn.copy.copied { background: #22c55e; }

  /* Products */
  .product-links {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .product-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.625rem 0;
    color: #475569;
    text-decoration: none;
    font-size: 0.9375rem;
    border-bottom: 1px solid #f1f5f9;
    transition: color 0.2s;
  }

  .product-link:hover { color: #0077b6; }
  .product-link:last-child { border-bottom: none; }

  .view-all-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.75rem;
    background: linear-gradient(135deg, #0077b6, #00b4d8);
    color: white;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    font-size: 0.875rem;
    transition: all 0.3s;
  }

  .view-all-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 119, 182, 0.3); color: white; }

  /* Article Content */
  .article-content {
    min-width: 0;
  }

  .prose {
    background: white;
    border-radius: 16px;
    padding: 3rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  }

  .prose :global(h2) {
    font-size: 1.625rem;
    font-weight: 700;
    color: #023e8a;
    margin: 2.5rem 0 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #e2e8f0;
  }

  .prose :global(h2:first-child) { margin-top: 0; }

  .prose :global(h3) {
    font-size: 1.25rem;
    font-weight: 600;
    color: #0077b6;
    margin: 2rem 0 0.75rem;
  }

  .prose :global(p) {
    color: #475569;
    line-height: 1.8;
    margin-bottom: 1.25rem;
    font-size: 1.0625rem;
  }

  .prose :global(ul), .prose :global(ol) {
    margin: 1.25rem 0;
    padding-left: 1.5rem;
  }

  .prose :global(li) {
    color: #475569;
    line-height: 1.7;
    margin-bottom: 0.5rem;
  }

  .prose :global(strong) { color: #1e293b; }

  .prose :global(a) {
    color: #0077b6;
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
    transition: color 0.2s;
  }

  .prose :global(a:hover) { color: #023e8a; }

  .prose :global(blockquote) {
    border-left: 4px solid #0077b6;
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    background: #f8fafc;
    border-radius: 0 8px 8px 0;
    font-style: italic;
    color: #475569;
  }

  .prose :global(code) {
    background: #f1f5f9;
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
    font-size: 0.9em;
    color: #e11d48;
  }

  .prose :global(pre) {
    background: #1e293b;
    padding: 1.25rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 1.5rem 0;
  }

  .prose :global(pre code) {
    background: none;
    color: #e2e8f0;
    padding: 0;
  }

  .prose :global(img) {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin: 1.5rem 0;
  }

  /* Tags */
  .post-tags {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #e2e8f0;
  }

  .tags-label { font-weight: 600; color: #475569; }

  .tags-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tag {
    background: #e8f4fd;
    color: #0077b6;
    padding: 0.375rem 0.875rem;
    border-radius: 50px;
    font-size: 0.8125rem;
    font-weight: 500;
  }

  /* Author Box */
  .author-box {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
    margin-top: 2rem;
    padding: 2rem;
    background: linear-gradient(135deg, #f8fafc, #e2e8f0);
    border-radius: 16px;
  }

  .author-avatar-large {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    background: linear-gradient(135deg, #0077b6, #00b4d8);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .author-box-label { font-size: 0.8125rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; }
  .author-box-name { font-size: 1.25rem; font-weight: 700; color: #1e293b; margin: 0.25rem 0 0.5rem; }
  .author-box-bio { color: #64748b; font-size: 0.9375rem; line-height: 1.6; margin: 0; }

  /* Mobile Share */
  .mobile-share {
    display: none;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #e2e8f0;
  }

  .mobile-share h3 { font-size: 1rem; font-weight: 600; color: #1e293b; margin: 0 0 1rem; }

  /* Related Section */
  .related-section {
    padding: 4rem 0;
    background: white;
  }

  .section-header { margin-bottom: 2rem; }

  .section-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
  }

  .section-title svg { color: #0077b6; }

  .related-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }

  .related-card {
    background: #f8fafc;
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.3s;
  }

  .related-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.15);
  }

  .related-image-link {
    display: block;
    aspect-ratio: 16/10;
    overflow: hidden;
  }

  .related-image-link img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s;
  }

  .related-card:hover .related-image-link img { transform: scale(1.05); }

  .related-image-link .placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
    color: #94a3b8;
  }

  .related-content { padding: 1.25rem; }

  .related-category {
    color: #0077b6;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-decoration: none;
  }

  .related-title {
    font-size: 1rem;
    font-weight: 600;
    margin: 0.5rem 0;
    line-height: 1.4;
  }

  .related-title a {
    color: #1e293b;
    text-decoration: none;
    transition: color 0.2s;
  }

  .related-title a:hover { color: #0077b6; }

  .related-meta { font-size: 0.8125rem; color: #94a3b8; }

  /* More Section */
  .more-section { padding: 4rem 0; }

  .more-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  .more-card {
    display: flex;
    gap: 1.5rem;
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    transition: all 0.3s;
  }

  .more-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.12);
  }

  .more-number {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    background: linear-gradient(135deg, #e8f4fd, #d1e9f6);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #0077b6;
    flex-shrink: 0;
  }

  .more-content { flex: 1; min-width: 0; }

  .more-category {
    color: #0077b6;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-decoration: none;
  }

  .more-title {
    font-size: 1.125rem;
    font-weight: 600;
    margin: 0.375rem 0 0.5rem;
    line-height: 1.4;
  }

  .more-title a {
    color: #1e293b;
    text-decoration: none;
    transition: color 0.2s;
  }

  .more-title a:hover { color: #0077b6; }

  .more-excerpt {
    color: #64748b;
    font-size: 0.9375rem;
    line-height: 1.5;
    margin-bottom: 0.75rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .more-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    color: #0077b6;
    font-size: 0.875rem;
    font-weight: 600;
    text-decoration: none;
    transition: gap 0.2s;
  }

  .more-link:hover { gap: 0.625rem; }

  /* Back Section */
  .back-section {
    padding: 3rem 0 4rem;
    text-align: center;
  }

  .back-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.625rem;
    background: white;
    color: #0077b6;
    padding: 1rem 2rem;
    border-radius: 50px;
    font-weight: 600;
    text-decoration: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s;
  }

  .back-btn:hover {
    transform: translateX(-4px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    color: #023e8a;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .content-grid { grid-template-columns: 1fr; }
    .sidebar { display: none; }
    .mobile-share { display: block; }
    .related-grid { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 768px) {
    .post-hero { padding: 3rem 0 2rem; }
    .post-title { font-size: 1.75rem; }
    .author-row { flex-direction: column; align-items: flex-start; }
    .featured-image-section { margin-top: -1.5rem; }
    .prose { padding: 2rem; }
    .prose :global(h2) { font-size: 1.375rem; }
    .prose :global(h3) { font-size: 1.125rem; }
    .prose :global(p) { font-size: 1rem; }
    .author-box { flex-direction: column; text-align: center; align-items: center; }
    .related-grid { grid-template-columns: 1fr; }
    .more-grid { grid-template-columns: 1fr; }
    .more-card { flex-direction: column; gap: 1rem; }
    .more-number { width: 48px; height: 48px; }
  }

  @media (max-width: 480px) {
    .container { padding: 0 1rem; }
    .prose { padding: 1.5rem; }
    .breadcrumb { font-size: 0.75rem; }
  }
</style>
