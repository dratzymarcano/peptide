---
import { getCollection } from 'astro:content';

interface Props {
  activeCategory?: string;
  showProductInfo?: boolean;
  productInfo?: {
    cas?: string;
    purity?: string;
    rating?: number;
    reviewCount?: number;
  };
}

const { activeCategory, showProductInfo = false, productInfo } = Astro.props;

// Get all products and calculate category counts
const products = await getCollection('products');
const categories = [...new Set(products.map((product) => product.data.category))];

// Category display names
const categorySEO: Record<string, { title: string }> = {
  'weight-loss': { title: 'Weight Loss Peptides' },
  'muscle-recovery': { title: 'Muscle & Recovery Peptides' },
  'growth-hormone': { title: 'Growth Hormone Peptides' },
  'tanning': { title: 'Tanning Peptides' },
  'cognitive': { title: 'Cognitive & Nootropic Peptides' },
  'supplies': { title: 'Supplies' }
};

const productCount = products.length;
---

<aside class="sidebar">
  <div class="sidebar-widget">
    <h3 class="sidebar-title">Categories</h3>
    <ul class="category-list">
      <li>
        <a href="/peptides/" class:list={["category-link", { active: !activeCategory }]}>
          All Peptides <span class="count">({productCount})</span>
        </a>
      </li>
      {categories.map(cat => {
        const catProducts = products.filter(p => p.data.category === cat);
        const isActive = activeCategory === cat;
        return (
          <li>
            <a href={`/peptides/${cat}/`} class:list={["category-link", { active: isActive }]}>
              {categorySEO[cat]?.title || cat.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
              <span class="count">({catProducts.length})</span>
            </a>
          </li>
        );
      })}
    </ul>
  </div>

  <div class="sidebar-widget why-us">
    <h4 class="sidebar-title">Why Peptide Shop?</h4>
    <ul class="why-list">
      <li>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#0077b6" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
        Lab-Verified Quality
      </li>
      <li>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#0077b6" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
        COA with Every Order
      </li>
      <li>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#0077b6" stroke-width="2"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>
        Fast UK Shipping
      </li>
      <li>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#0077b6" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        Expert Support
      </li>
    </ul>
  </div>

  {showProductInfo && productInfo && (
    <div class="sidebar-widget product-info">
      <h5 class="sidebar-title">Quick Info</h5>
      <ul class="info-list">
        {productInfo.cas && (
          <li>
            <span class="label">CAS</span>
            <span class="value">{productInfo.cas}</span>
          </li>
        )}
        {productInfo.purity && (
          <li>
            <span class="label">Purity</span>
            <span class="value purity">{productInfo.purity}</span>
          </li>
        )}
        {productInfo.rating !== undefined && (
          <li>
            <span class="label">Rating</span>
            <span class="value">
              <span class="star">â˜…</span> {productInfo.rating.toFixed(1)} ({productInfo.reviewCount || 0})
            </span>
          </li>
        )}
        <li>
          <span class="label">Stock</span>
          <span class="value stock">In Stock</span>
        </li>
      </ul>
    </div>
  )}
</aside>

<style>
  .sidebar {
    width: 280px;
    flex-shrink: 0;
  }

  .sidebar-widget {
    background: white;
    border-radius: 12px;
    padding: 24px;
    border: 1px solid #e2e8f0;
    margin-bottom: 24px;
  }

  .sidebar-title {
    font-size: 1rem;
    font-weight: 700;
    color: #0f172a;
    margin-bottom: 16px;
  }

  .category-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .category-list li {
    margin-bottom: 8px;
  }

  .category-link {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    border-radius: 8px;
    color: #475569;
    text-decoration: none;
    font-size: 14px;
    transition: all 0.2s;
  }

  .category-link:hover {
    background: #f1f5f9;
    color: #0077b6;
  }

  .category-link.active {
    background: #0077b6;
    color: white;
    font-weight: 600;
  }

  .category-link .count {
    font-size: 12px;
    opacity: 0.7;
  }

  .why-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .why-list li {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    font-size: 14px;
    color: #475569;
  }

  .info-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .info-list li {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #f1f5f9;
    font-size: 14px;
  }

  .info-list li:last-child {
    border-bottom: none;
  }

  .info-list .label {
    color: #64748b;
  }

  .info-list .value {
    font-weight: 600;
    color: #1e293b;
  }

  .info-list .value.purity {
    color: #10b981;
  }

  .info-list .value.stock {
    color: #10b981;
  }

  .info-list .star {
    color: #f5a623;
  }

  /* Responsive */
  @media (max-width: 991px) {
    .sidebar {
      width: 100%;
      margin-bottom: 24px;
    }

    .sidebar-widget {
      padding: 20px;
    }
  }

  @media (max-width: 767px) {
    .sidebar {
      display: none;
    }
  }
</style>
