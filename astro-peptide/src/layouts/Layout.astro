---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SEO from '../components/SEO.astro';
import { getLangFromUrl } from '../i18n/translations';
import { getMarket } from '../i18n/market';

interface BreadcrumbItem {
	name: string;
	url: string;
}

interface Props {
	title: string;
	description?: string;
	image?: string;
	article?: boolean;
	breadcrumbs?: BreadcrumbItem[];
}

const { title, description, image, article, breadcrumbs } = Astro.props;
const siteUrl = 'https://peptide-shop.net';

const currentLang = getLangFromUrl(Astro.url);
const market = getMarket(currentLang);

// Generate breadcrumb schema if breadcrumbs are provided
const breadcrumbSchema = breadcrumbs && breadcrumbs.length > 0 ? {
	"@context": "https://schema.org",
	"@type": "BreadcrumbList",
	"itemListElement": breadcrumbs.map((item, index) => ({
		"@type": "ListItem",
		"position": index + 1,
		"name": item.name,
		"item": item.url.startsWith('http') ? item.url : `${siteUrl}${item.url}`
	}))
} : null;
---

<!doctype html>
<html lang={market.hreflang}>
	<head>
		<SEO title={title} description={description} image={image} article={article} lang={currentLang} />
		
		{breadcrumbSchema && (
			<script is:inline type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
		)}
		
		<!-- Google Fonts - Raleway -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
		<!-- Lucide Icons - Premium icon set (pinned version for stability) -->
		<script is:inline src="https://unpkg.com/lucide@0.294.0/dist/umd/lucide.min.js" defer></script>
		<script is:inline>
			document.addEventListener('DOMContentLoaded', function() {
				if (typeof lucide !== 'undefined') {
					lucide.createIcons();
				}
			});
		</script>
		<!-- bootstrap.min css -->
		<link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css">
		<!-- animate.css -->
		<link rel="stylesheet" href="/plugins/animate-css/animate.css">
		<!-- Magnify Popup -->
		<link rel="stylesheet" href="/plugins/magnific-popup/dist/magnific-popup.css">
		<!-- Owl Carousel CSS -->
		<link rel="stylesheet" href="/plugins/slick-carousel/slick/slick.css">
		<link rel="stylesheet" href="/plugins/slick-carousel/slick/slick-theme.css">
		<!-- Main Stylesheet -->
		<link rel="stylesheet" href="/css/style.css">
		<style>
			/* Skip to content link for accessibility */
			.skip-to-content {
				position: absolute;
				left: -9999px;
				top: 0;
				z-index: 10000;
				padding: 12px 24px;
				background: #0077b6;
				color: white;
				font-weight: 600;
				text-decoration: none;
				border-radius: 0 0 8px 8px;
			}
			.skip-to-content:focus {
				left: 50%;
				transform: translateX(-50%);
			}
		</style>
	</head>
	<body>
		<a href="#main-content" class="skip-to-content">Skip to main content</a>
		<Header />
		<div class="main-wrapper" id="main-content">
			<slot />
			<Footer />
		</div>

		<!-- Essential Scripts -->
		<!-- Main jQuery -->
		<script is:inline src="/plugins/jquery/jquery.js" defer></script>
		<!-- Bootstrap 4.3.1 -->
		<script is:inline src="/plugins/bootstrap/js/bootstrap.min.js" defer></script>
		<!-- Slick Slider -->
		<script is:inline src="/plugins/slick-carousel/slick/slick.min.js" defer></script>
		<!--  Magnific Popup-->
		<script is:inline src="/plugins/magnific-popup/dist/jquery.magnific-popup.min.js" defer></script>
		<!-- Form Validator -->
		<script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.32/jquery.form.js" defer></script>
		<script is:inline src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.11.1/jquery.validate.min.js" defer></script>
		<!-- Google Map -->
		<!-- <script is:inline src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBu5nZKbeK-WHQ70oqOWo-_4VmwOwKP9YQ"></script> -->
		<script is:inline src="/plugins/google-map/gmap.js" defer></script>

		<script is:inline src="/js/script.js" defer></script>

		<script>
			import { currentCurrency, fetchExchangeRate } from '../store/currencyStore';
			import { getLangFromUrl } from '../i18n/translations';

			// Initialize currency based on language
			const initCurrency = async () => {
				const lang = getLangFromUrl(new URL(window.location.href));
				
				if (lang === 'en') {
					currentCurrency.set('GBP');
				} else {
					// For all other supported European languages, set to EUR
					currentCurrency.set('EUR');
					await fetchExchangeRate();
				}
			};

			// Run on initial load
			initCurrency();
		</script>
	</body>
</html>
